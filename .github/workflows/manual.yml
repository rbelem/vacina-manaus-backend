name: Update VacinaManaus data CI

on:
  workflow_dispatch:

jobs:
  update-data:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - name: Download the latest pdf
      run: |
        make download-data
    - name: Extract
      run: |
        make extract-data
    - name: Process
      run: |
        make process-data
    - name: Get current time
      uses: 1466587594/get-current-time@v2
      id: now
      with:
        format: YYYYMMDDHHmm
        utcOffset: "-04:00"
    - name: Set branch name
      run: "branch_name=update-data-${{steps.now.outputs.formattedTime}}"
    - name: Checkout to branch
      run: git checkout -b $branch_name
    - name: Commit and push
      uses: stefanzweifel/git-auto-commit-action@v4
      with:
        branch: ${{ env.branch_name }}
        commit_message: 'chore: Atualiza os dados com a Ãºltima lista divulgada ${{steps.now.outputs.formattedTime}}'
